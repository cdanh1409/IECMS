{"ast":null,"code":"// routers/account.js\nconst express = require(\"express\");\nconst router = express.Router();\nconst {\n  poolPromise,\n  sql\n} = require(\"../src/db\");\n\n// --- Lấy tất cả account ---\nrouter.get(\"/\", async (req, res) => {\n  try {\n    const pool = await poolPromise;\n    const result = await pool.request().query(\"SELECT * FROM dbo.ACCOUNT\");\n    res.json(result.recordset);\n  } catch (err) {\n    res.status(500).json({\n      error: err.message\n    });\n  }\n});\n\n// --- Lấy account theo USER_ID ---\nrouter.get(\"/:userId\", async (req, res) => {\n  try {\n    const {\n      userId\n    } = req.params;\n    const pool = await poolPromise;\n    const result = await pool.request().input(\"USER_ID\", sql.Int, userId).query(\"SELECT * FROM dbo.ACCOUNT WHERE USER_ID = @USER_ID\");\n    res.json(result.recordset[0]);\n  } catch (err) {\n    res.status(500).json({\n      error: err.message\n    });\n  }\n});\n\n// --- Thêm account mới ---\nrouter.post(\"/\", async (req, res) => {\n  const {\n    USER_ID,\n    USERNAME,\n    PASSWORD,\n    ROLE\n  } = req.body;\n  if (!USER_ID || !USERNAME || !PASSWORD) return res.status(400).json({\n    error: \"Thiếu dữ liệu\"\n  });\n  try {\n    const pool = await poolPromise;\n    const result = await pool.request().input(\"USER_ID\", sql.Int, USER_ID).input(\"USERNAME\", sql.NVarChar(100), USERNAME).input(\"PASSWORD\", sql.NVarChar(100), PASSWORD).input(\"ROLE\", sql.NVarChar(20), ROLE || \"user\").query(`\n        INSERT INTO dbo.ACCOUNT(USER_ID, USERNAME, PASSWORD, ROLE)\n        OUTPUT INSERTED.*\n        VALUES (@USER_ID, @USERNAME, @PASSWORD, @ROLE)\n      `);\n    res.json(result.recordset[0]);\n  } catch (err) {\n    res.status(500).json({\n      error: err.message\n    });\n  }\n});\nmodule.exports = router;","map":{"version":3,"names":["express","require","router","Router","poolPromise","sql","get","req","res","pool","result","request","query","json","recordset","err","status","error","message","userId","params","input","Int","post","USER_ID","USERNAME","PASSWORD","ROLE","body","NVarChar","module","exports"],"sources":["D:/Web/IECMS/src/routes/account.js"],"sourcesContent":["// routers/account.js\r\nconst express = require(\"express\");\r\nconst router = express.Router();\r\nconst { poolPromise, sql } = require(\"../src/db\");\r\n\r\n// --- Lấy tất cả account ---\r\nrouter.get(\"/\", async (req, res) => {\r\n  try {\r\n    const pool = await poolPromise;\r\n    const result = await pool.request().query(\"SELECT * FROM dbo.ACCOUNT\");\r\n    res.json(result.recordset);\r\n  } catch (err) {\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n});\r\n\r\n// --- Lấy account theo USER_ID ---\r\nrouter.get(\"/:userId\", async (req, res) => {\r\n  try {\r\n    const { userId } = req.params;\r\n    const pool = await poolPromise;\r\n    const result = await pool\r\n      .request()\r\n      .input(\"USER_ID\", sql.Int, userId)\r\n      .query(\"SELECT * FROM dbo.ACCOUNT WHERE USER_ID = @USER_ID\");\r\n    res.json(result.recordset[0]);\r\n  } catch (err) {\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n});\r\n\r\n// --- Thêm account mới ---\r\nrouter.post(\"/\", async (req, res) => {\r\n  const { USER_ID, USERNAME, PASSWORD, ROLE } = req.body;\r\n  if (!USER_ID || !USERNAME || !PASSWORD)\r\n    return res.status(400).json({ error: \"Thiếu dữ liệu\" });\r\n\r\n  try {\r\n    const pool = await poolPromise;\r\n    const result = await pool\r\n      .request()\r\n      .input(\"USER_ID\", sql.Int, USER_ID)\r\n      .input(\"USERNAME\", sql.NVarChar(100), USERNAME)\r\n      .input(\"PASSWORD\", sql.NVarChar(100), PASSWORD)\r\n      .input(\"ROLE\", sql.NVarChar(20), ROLE || \"user\").query(`\r\n        INSERT INTO dbo.ACCOUNT(USER_ID, USERNAME, PASSWORD, ROLE)\r\n        OUTPUT INSERTED.*\r\n        VALUES (@USER_ID, @USERNAME, @PASSWORD, @ROLE)\r\n      `);\r\n    res.json(result.recordset[0]);\r\n  } catch (err) {\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}